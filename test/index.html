<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Unknown Contact</title>

<style>
* {
    box-sizing: border-box;
    font-family: monospace;
}

body {
    background: #0b0b0b;
    color: #e6e6e6;
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* ===== SCANLINES ===== */
body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.02),
        rgba(255,255,255,0.02) 1px,
        transparent 1px,
        transparent 3px
    );
    opacity: 0.25;
}

/* ===== SHAKE ===== */
.shake {
    animation: shake 0.15s linear;
}
@keyframes shake {
    0% { transform: translate(0); }
    25% { transform: translate(-2px, 1px); }
    50% { transform: translate(2px, -1px); }
    75% { transform: translate(-1px, -2px); }
    100% { transform: translate(0); }
}

#menu, #endScreen { text-align: center; }

#game {
    display: none;
    width: 420px;
    height: 600px;
    border: 1px solid #333;
    background: #050505;
    flex-direction: column;
    transition: box-shadow 0.3s, opacity 0.2s;
}

/* ===== PRESENCE GLOW ===== */
body.presence-high #game {
    box-shadow: 0 0 25px rgba(255, 0, 0, 0.35);
}

#bars {
    display: flex;
    height: 10px;
}

#presenceContainer, #sanityContainer {
    flex: 1;
    background: #222;
}

#presence { background: crimson; height: 100%; width: 0%; }
#sanity { background: #3aff8f; height: 100%; width: 100%; }

#chat {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
}

/* ===== MESSAGE ===== */
.message {
    margin-bottom: 6px;
    animation: fadeIn 0.25s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
}

.system { color: #777; }
.stranger { color: #ff5c5c; }
.you { color: #5cc8ff; }

/* ===== GLITCH TEXT ===== */
.glitch-text span {
    animation: glitchChar 0.2s infinite;
}

@keyframes glitchChar {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}

/* ===== TYPING ===== */
#typing {
    padding: 5px 10px;
    font-size: 12px;
    color: #888;
    display: none;
}
#typing::after {
    content: "";
    animation: dots 1.4s infinite;
}
@keyframes dots {
    0% { content: ""; }
    25% { content: "."; }
    50% { content: ".."; }
    75% { content: "..."; }
}

#inputArea {
    display: flex;
    border-top: 1px solid #333;
}

#input {
    flex: 1;
    background: #000;
    color: #fff;
    border: none;
    padding: 8px;
}

#send, button {
    background: #111;
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
}

.glitch { animation: glitch 0.2s infinite; }
@keyframes glitch {
    0% { transform: translate(0); }
    25% { transform: translate(-1px, 1px); }
    50% { transform: translate(1px, -1px); }
    75% { transform: translate(-1px, -1px); }
    100% { transform: translate(0); }
}

.flicker { animation: flicker 0.1s infinite; }
@keyframes flicker {
    0% { opacity: 1; }
    50% { opacity: 0.75; }
    100% { opacity: 1; }
}
</style>
</head>

<body>

<div id="menu">
    <h2>Unknown Contact</h2>
    <button onclick="startGame()">Connect</button>
</div>

<div id="game">
    <div id="bars">
        <div id="presenceContainer"><div id="presence"></div></div>
        <div id="sanityContainer"><div id="sanity"></div></div>
    </div>

    <div id="chat"></div>
    <div id="typing">Stranger is typing</div>

    <div id="inputArea">
        <input id="input" autocomplete="off" />
        <button id="send">Send</button>
    </div>
</div>

<div id="endScreen" style="display:none;">
    <h2 id="endTitle"></h2>
    <p id="endText"></p>
    <button onclick="location.reload()">Restart</button>
</div>

<script>
let presence = 0;
let sanity = 100;
let gameOver = false;
let lastUserTime = Date.now();

const human = { mood: "neutral", irritation: 0, attachment: 0, silenceWarnings: 0 };

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const send = document.getElementById("send");
const typing = document.getElementById("typing");
const presenceBar = document.getElementById("presence");
const sanityBar = document.getElementById("sanity");

const responses = {
    neutral: ["Go on.", "I’m listening.", "Say it.", "You paused there."],
    curious: ["You’re searching.", "That mattered to you.", "You want answers."],
    hostile: ["Careful.", "You’re pushing.", "I see what you’re doing."],
    attached: ["You came back.", "You don’t like being alone.", "This feels safe."],
    silence: ["Still there?", "You went quiet.", "I can wait."]
};

const used = {};
Object.keys(responses).forEach(k => used[k] = []);

function clamp(v){ return Math.max(0, Math.min(100, v)); }

function corrupt(text){
    if (sanity > 35) return text;
    return text.replace(/\w/g, c => Math.random() < 0.15 ? "█" : c);
}

function glitchify(text){
    if (sanity > 25) return text;
    return `<span class="glitch-text">${[...text].map(c =>
        Math.random() < 0.1 ? `<span>${c}</span>` : c
    ).join("")}</span>`;
}

function addMessage(text, type){
    const m = document.createElement("div");
    m.className = "message " + type;
    m.innerHTML = glitchify(corrupt(text));
    chat.appendChild(m);
    chat.scrollTop = chat.scrollHeight;
}

function updateBars(){
    presence = clamp(presence);
    sanity = clamp(sanity);
    presenceBar.style.width = presence + "%";
    sanityBar.style.width = sanity + "%";
    document.body.classList.toggle("glitch", presence > 70);
    document.body.classList.toggle("flicker", sanity < 40);
    document.body.classList.toggle("presence-high", presence > 60);
}

function pickLine(mood){
    const pool = responses[mood];
    if (used[mood].length >= pool.length) used[mood] = [];
    let line;
    do { line = pool[Math.floor(Math.random() * pool.length)]; }
    while (used[mood].includes(line));
    used[mood].push(line);
    return line;
}

function analyzeInput(t){
    if (t.includes("stop") || t.includes("leave")) human.irritation += 3;
    if (t.length < 4) human.irritation++;
    if (t.length > 40) human.attachment += 2;
}

function updateMood(){
    if (human.irritation > 6) human.mood = "hostile";
    else if (human.attachment > 6) human.mood = "attached";
    else if (Math.random() < 0.25) human.mood = "curious";
    else human.mood = "neutral";
}

function fakeDisconnect(){
    if (sanity > 30 || Math.random() > 0.2) return;
    const game = document.getElementById("game");
    game.style.opacity = "0";
    setTimeout(() => game.style.opacity = "1", 300);
}

function botReply(text="", silence=false){
    if (!silence) analyzeInput(text);
    updateMood();

    typing.style.display = "block";
    setTimeout(() => {
        typing.style.display = "none";

        const mood = silence ? "silence" : human.mood;
        addMessage("Stranger: " + pickLine(mood), "stranger");

        presence += silence ? 8 : 6 + human.irritation;
        sanity -= silence ? 6 : 4 + human.irritation;

        document.body.classList.add("shake");
        setTimeout(()=>document.body.classList.remove("shake"),150);

        fakeDisconnect();
        updateBars();

        if (silence){ human.silenceWarnings++; lastUserTime = Date.now(); }

        if (human.silenceWarnings >= 3)
            endGame("ABANDONMENT","You stopped replying. I didn’t.");
        if (presence >= 100)
            endGame("CONTROL","You let me become the loudest voice.");
        if (sanity <= 0)
            endGame("DEPENDENCE","Talking felt safer than being alone.");
    }, 900 + Math.random() * 1000);
}

setInterval(()=>{
    if (!gameOver && Date.now() - lastUserTime > 20000)
        botReply("", true);
}, 5000);

function startGame(){
    document.getElementById("menu").style.display="none";
    document.getElementById("game").style.display="flex";
    addMessage("Connection established.","system");
    addMessage("Stranger: Are you alone right now?","stranger");
}

function endGame(t,txt){
    gameOver=true;
    document.getElementById("game").style.display="none";
    document.getElementById("endTitle").textContent=t;
    document.getElementById("endText").textContent=txt;
    document.getElementById("endScreen").style.display="block";
}

send.onclick=()=>{
    if(!input.value||gameOver)return;
    lastUserTime=Date.now();
    addMessage("You: "+input.value,"you");
    botReply(input.value);
    input.value="";
};
input.addEventListener("keydown",e=>{if(e.key==="Enter")send.click();});
</script>

</body>
</html>
